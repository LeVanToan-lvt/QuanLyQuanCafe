#DanhGiaBinhLuan.aspx
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="DanhGiaBinhLuan.aspx.cs" Inherits="DanhGiaBinhLuan"
    MasterPageFile="~/Site1.Master" %>

<asp:Content ID="Content1" ContentPlaceHolderID="MainContent" runat="server">
    <div class="container" style="max-width:900px; margin:auto; padding:20px;">
        <h2 style="text-align:center; margin-bottom:15px;">Đánh giá &amp; Bình luận món</h2>

        <!-- Thông tin món -->
        <asp:Panel ID="pnlInfo" runat="server" CssClass="card"
            Style="padding:15px; margin-bottom:20px; box-shadow:0 0 8px #ccc; border-radius:10px;">
            <asp:Label ID="lblMaMon" runat="server" Text="Mã món: ..." Font-Bold="true"></asp:Label><br />
            <asp:Label ID="lblTenMon" runat="server" Text="Tên món: ..." Font-Size="Large"></asp:Label><br />
            <asp:Label ID="lblDiemTB" runat="server" Text="Điểm trung bình: 0.0 / 5"
                ForeColor="OrangeRed" Font-Bold="true"></asp:Label>
        </asp:Panel>

        <!-- Form đánh giá -->
        <asp:Panel ID="pnlRating" runat="server" CssClass="card"
            Style="padding:15px; margin-bottom:20px; box-shadow:0 0 8px #ccc; border-radius:10px;">
            <h4>Viết đánh giá của bạn</h4>

            <div style="margin-bottom:10px;">
                <asp:Label ID="lblTenKhach" runat="server" Text="Tên của bạn:" AssociatedControlID="txtTenKhach"></asp:Label><br />
                <asp:TextBox ID="txtTenKhach" runat="server" CssClass="form-control" Width="60%"
                    placeholder="Nhập tên hoặc nickname"></asp:TextBox>
                <asp:RequiredFieldValidator ID="rfvTen" runat="server"
                    ControlToValidate="txtTenKhach" ForeColor="Red"
                    ErrorMessage="Vui lòng nhập tên." Display="Dynamic" />
            </div>

            <div style="margin-bottom:10px;">
                <asp:Label ID="lblSao" runat="server" Text="Chọn số sao: "></asp:Label><br />
                <asp:RadioButtonList ID="rblSao" runat="server" RepeatDirection="Horizontal">
                    <asp:ListItem Text="1 ⭐" Value="1"></asp:ListItem>
                    <asp:ListItem Text="2 ⭐⭐" Value="2"></asp:ListItem>
                    <asp:ListItem Text="3 ⭐⭐⭐" Value="3" Selected="True"></asp:ListItem>
                    <asp:ListItem Text="4 ⭐⭐⭐⭐" Value="4"></asp:ListItem>
                    <asp:ListItem Text="5 ⭐⭐⭐⭐⭐" Value="5"></asp:ListItem>
                </asp:RadioButtonList>
            </div>

            <div style="margin-bottom:10px;">
                <asp:Label ID="lblNoiDung" runat="server" Text="Nội dung bình luận:"
                    AssociatedControlID="txtNoiDung"></asp:Label><br />
                <asp:TextBox ID="txtNoiDung" runat="server" CssClass="form-control"
                    TextMode="MultiLine" Rows="4" Width="100%"
placeholder="Chia sẻ cảm nhận của bạn về món này..."></asp:TextBox>
                <asp:RequiredFieldValidator ID="rfvNoiDung" runat="server"
                    ControlToValidate="txtNoiDung" ForeColor="Red"
                    ErrorMessage="Vui lòng nhập nội dung bình luận." Display="Dynamic" />
            </div>

            <div style="margin-top:10px;">
                <asp:Button ID="btnGui" runat="server" Text="Gửi đánh giá"
                    CssClass="btn btn-success" OnClick="btnGui_Click" />
                <asp:Label ID="lblThongBao" runat="server" ForeColor="Green"
                    Style="margin-left:10px;"></asp:Label>
            </div>

            <asp:ValidationSummary ID="ValidationSummary1" runat="server"
                ForeColor="Red" HeaderText="Có lỗi:" />
        </asp:Panel>

        <!-- Danh sách bình luận -->
        <asp:Panel ID="pnlComments" runat="server" CssClass="card"
            Style="padding:15px; box-shadow:0 0 8px #ccc; border-radius:10px;">
            <h4>Danh sách bình luận</h4>

            <asp:GridView ID="gvBinhLuan" runat="server" AutoGenerateColumns="False"
                CssClass="table table-striped table-bordered" EmptyDataText="Chưa có bình luận nào.">
                <Columns>
                    <asp:BoundField DataField="TenKhach" HeaderText="Người đánh giá" />
                    <asp:BoundField DataField="SoSao" HeaderText="Số sao" />
                    <asp:BoundField DataField="NoiDung" HeaderText="Nội dung" />
                    <asp:BoundField DataField="Ngay" HeaderText="Ngày" DataFormatString="{0:dd/MM/yyyy HH:mm}" />
                </Columns>
            </asp:GridView>
        </asp:Panel>
    </div>
</asp:Content>

#DanhGiaBinhLuan.aspx.cs
using System;
using System.Data;

public partial class DanhGiaBinhLuan : System.Web.UI.Page
{
    private DataTable BinhLuanTable
    {
        get
        {
            if (ViewState["BinhLuan"] == null)
            {
                DataTable dt = new DataTable();
                dt.Columns.Add("TenKhach");
                dt.Columns.Add("SoSao", typeof(int));
                dt.Columns.Add("NoiDung");
                dt.Columns.Add("Ngay", typeof(DateTime));
                ViewState["BinhLuan"] = dt;
            }
            return (DataTable)ViewState["BinhLuan"];
        }
        set { ViewState["BinhLuan"] = value; }
    }

    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            string maMon = Request.QueryString["maMon"] ?? "CF01";
            lblMaMon.Text = "Mã món: " + maMon;
            lblTenMon.Text = "Tên món: Cà phê đen đá (demo)";

            // Thêm 1 vài bình luận mẫu
            DataTable dt = BinhLuanTable;
            dt.Rows.Add("Khách A", 5, "Rất ngon, sẽ quay lại!", DateTime.Now.AddDays(-1));
            dt.Rows.Add("Khách B", 4, "Ổn, giá hợp lý.", DateTime.Now.AddHours(-5));
            BinhLuanTable = dt;

            BindBinhLuan();
        }
    }

    private void BindBinhLuan()
    {
        gvBinhLuan.DataSource = BinhLuanTable;
        gvBinhLuan.DataBind();

        // Tính điểm trung bình
        DataTable dt = BinhLuanTable;
        if (dt.Rows.Count > 0)
        {
            double tong = 0;
            foreach (DataRow r in dt.Rows)
                tong += Convert.ToInt32(r["SoSao"]);
            double tb = tong / dt.Rows.Count;
            lblDiemTB.Text = "Điểm trung bình: " + tb.ToString("0.0") + " / 5";
        }
        else
        {
            lblDiemTB.Text = "Điểm trung bình: 0.0 / 5";
        }
    }

    protected void btnGui_Click(object sender, EventArgs e)
    {
        if (!Page.IsValid) return;

        DataTable dt = BinhLuanTable;
        dt.Rows.Add(
            txtTenKhach.Text.Trim(),
            int.Parse(rblSao.SelectedValue),
            txtNoiDung.Text.Trim(),
            DateTime.Now
        );
        BinhLuanTable = dt;

        txtTenKhach.Text = "";
        txtNoiDung.Text = "";
        rblSao.SelectedValue = "3";

        lblThongBao.Text = "Cảm ơn bạn đã đánh giá!";

        BindBinhLuan();
    }
}
